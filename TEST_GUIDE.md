# 测试指南 - 桌宠 Claude Code

## 功能测试清单

### ✅ 0. 仪表盘快捷键
**测试步骤：**
1. 使用 `Shift+Control` 切换 Kohaku 仪表盘
2. 如果系统不支持纯修饰键组合，使用 `CmdOrCtrl+Shift+K`

**预期结果：**
- ✅ 仪表盘窗口成功显示

### ✅ 1. 基础对话功能
**测试步骤：**
1. 启动应用（双击桌宠显示对话框）
2. 输入：`你好，请介绍一下你自己`
3. 观察流式输出

**预期结果：**
- ✅ 流式显示 Claude 回复
- ✅ 打字机效果流畅
- ✅ 消息正确显示在对话框中

---

### ✅ 2. @ 文件引用功能
**测试步骤 A：手动点击 @ 按钮**
1. 点击输入框左侧的 `@` 按钮
2. 在文件选择器中选择任意文件（如 package.json）
3. 文件路径自动添加到输入框
4. 输入：`这个文件是做什么的？`
5. 发送消息

**测试步骤 B：键盘输入 @**
1. 在输入框中直接输入 `@`
2. 文件选择器自动弹出
3. 选择文件
4. 文件路径自动添加

**预期结果：**
- ✅ 文件选择器正确弹出
- ✅ 文件路径格式：`@"/path/to/file"`
- ✅ Claude 能够读取并分析文件内容

---

### ✅ 3. 权限确认对话框
**测试步骤：**
1. 输入需要工具权限的任务，例如：
   - `请帮我创建一个新文件 test.txt，内容是"Hello World"`
   - `列出当前目录下的所有文件`
   - `读取 package.json 文件`

2. 等待权限对话框弹出

**权限对话框应显示：**
```
🔐 Permission Required
[工具名称]
[操作描述]
[参数详情]

[Deny] [Allow]
[Always Deny] [Always Allow]
```

**测试各个按钮：**
- **Deny**: 拒绝后任务应停止，显示错误消息
- **Allow**: 允许后任务继续执行
- **Always Allow**: 下次相同工具不再提示
- **Always Deny**: 下次相同工具自动拒绝

**预期结果：**
- ✅ 对话框在需要权限时正确弹出
- ✅ 显示清晰的工具名称和描述
- ✅ 四个按钮功能正常
- ✅ 选择后对话框关闭，任务继续或停止

---

### ✅ 4. 会话管理
**测试步骤：**
1. 发送多条消息
2. 刷新应用或重启
3. 检查历史消息是否保留

**预期结果：**
- ✅ 会话历史正确保存
- ✅ 重启后可恢复对话

---

### ✅ 5. 中断功能
**测试步骤：**
1. 发送长回复的问题：`请详细介绍 TypeScript 的所有特性`
2. 在回复过程中点击 Stop 按钮（■）

**预期结果：**
- ✅ 响应立即停止
- ✅ 已接收的部分显示为消息
- ✅ 可以继续发送新消息

---

## 常见问题排查

### Q: 权限对话框没有弹出？
**解决方案：**
1. 检查控制台日志是否有 `Permission request` 消息
2. 确认 ClaudeAgentService 的 permissionCallback 已设置
3. 尝试需要明确权限的任务（如创建文件、运行命令）

### Q: @ 输入后文件选择器没弹出？
**解决方案：**
1. 检查 handleInputChange 函数是否正确触发
2. 确认 selectFile 函数正常工作
3. 手动点击 @ 按钮测试

### Q: 文件内容没有传给 Claude？
**解决方案：**
1. 确认文件路径格式正确：`@"/path/to/file"`
2. Claude Code SDK 会自动处理 @ 引用
3. 检查文件是否存在且有读取权限

---

## 推荐测试场景

### 场景 1: 代码审查
```
输入: @[选择一个代码文件]
      请审查这个文件的代码质量
```
- 测试文件引用
- 测试 Claude 的代码分析能力

### 场景 2: 文件操作
```
输入: 请在当前目录创建一个 hello.txt 文件，写入"Hello Claude"
```
- 测试权限对话框（Write 工具）
- 测试 Allow/Deny 功能

### 场景 3: 命令执行
```
输入: 请运行 ls -la 命令，显示当前目录内容
```
- 测试权限对话框（Bash 工具）
- 测试 Always Allow 功能

### 场景 4: 多文件分析
```
输入: @[文件1] @[文件2]
      比较这两个文件的差异
```
- 测试多文件引用
- 测试复杂任务处理

---

## 性能检查

- [ ] 响应延迟 < 2秒（首次加载 SDK）
- [ ] 流式输出流畅，无明显卡顿
- [ ] 内存使用正常（< 300MB）
- [ ] CPU 使用正常（闲置 < 5%）

---

## 成功标准

✅ 所有核心功能正常工作
✅ 权限系统正确拦截工具使用
✅ 文件引用功能完整可用
✅ 无崩溃、无错误提示
✅ UI 响应流畅，用户体验良好
